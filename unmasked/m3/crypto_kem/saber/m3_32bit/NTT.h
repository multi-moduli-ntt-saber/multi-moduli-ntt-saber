#ifndef NTT_H
#define NTT_H

#include "SABER_params.h"
#include <stdint.h>


static const uint32_t twiddles[] = {15819606, 10456819, 6778549, 3927384, 13708128, 3333183, 17379375, 14672026, 16331523, 23973142, 12946161, 11044490, 2113559, 4862186, 12446784, 13450938, 19688239, 14374602, 10265463, 4135820, 11410912, 19978413, 23186411, 5324400, 15508013, 4543018, 18435621, 11247890, 20503562, 10925857, 18356976, 9694922, 23364730, 14523207, 18724034, 23578947, 10026366, 12214809, 11687629, 9324823, 21391632, 21039891, 8376768, 20693015, 20891462, 23400914, 14581325, 21578259, 2985234, 15084562, 21315916, 228560, 587030, 2868469, 1696077, 4056008, 1586642, 19149710, 19955077, 4900932, 19323068, 14406467, 16451040, 632668, 16688556, 11508354, 6175695, 11420910, 4344650, 1919030, 19731214, 20677106, 1902898, 15871484, 18973296, 21351417, 12038585, 6669390, 22387578, 18129380, 18500878, 13875000, 8654721, 11030746, 18465697, 18589063, 13268129, 17235176, 15364236, 23414839, 17446359, 701737, 22146762, 22935694, 10357424, 7245113, 8079648, 18465049, 6991324, 15671273, 20171942, 14752388, 23177262, 18290700, 3616172, 3803606, 2814992, 12506386, 22194035, 14152981, 55762, 6558844, 667111, 12090048, 3971895, 10531211, 24258592, 11605612, 1248015, 14321926, 22481166, 1302629, 3603005, 16031872, 18541967, 10070719, 18489938, 1027635, 1195847, 4413844, 17686025, 20429648, 9194262, 5401872, 1502330, 3337356, 143363, 15131957, 2524604, 3458597, 23927953, 1617055, 2430208, 13446262, 6684921, 19418677, 2484232, 19873807, 10734669, 10095079, 11128617, 2982564, 8697150, 1621394, 15943924, 151668, 18270351, 18604110, 4950541, 8978626, 9954956, 6791101, 13613697, 5859458, 15800433, 883411, 19149285, 15688438, 439800, 8401279, 21902943, 16841171, 24103990, 2590917, 20826067, 23717911, 17834047, 11133158, 6441259, 7238671, 22026666, 5549675, 2653886, 22957916, 8888852, 15871991, 15400860, 2690208, 23984142, 23690486, 1015493, 21666575, 10847467, 17921336, 23522565, 4360437, 7037443, 16186365, 6849403, 5891100, 19789492, 20619013, 20725428, 15318469, 11058871, 17873869, 3053282, 1397416, 17844256, 8385038, 2142558, 12744765, 9981572, 24472442, 23983096, 16456862, 15864935, 22353801, 3686319, 6075986, 17369762, 22215596, 11015242, 12390938, 11259461, 6668584, 8704176, 7134333, 8373409, 13009476, 2731815, 15709060, 13564032, 15330445, 6385828, 2920732, 2528064, 18289886, 13487669, 22002422, 11771991, 14220771, 15395272, 12464090, 15521617, 20748932, 7140031, 22951637, 20990206, 12583083, 14768256, 11209398, 17378310, 10579778, 24063766, 3810156};
// RinvN in last twiddle (the one before the last array element): (14714638*(-8394241))%25171457 (manually computed)
static const uint32_t twiddles_inv_RinvN[] = {21361301, 1107691, 14591679, 7793147, 13962059, 10403201, 12588374, 4181251, 2219820, 18031426, 4422525, 9649840, 12707367, 9776185, 10950686, 13399466, 3169035, 11683788, 6881571, 22643393, 22250725, 18785629, 9841012, 11607425, 9462397, 22439642, 12161981, 16798048, 18037124, 16467281, 18502873, 13911996, 12780519, 14156215, 2955861, 7801695, 19095471, 21485138, 2817656, 9306522, 8714595, 1188361, 699015, 15189885, 12426692, 23028899, 16786419, 7327201, 23774041, 22118175, 7297588, 14112586, 9852988, 4446029, 4552444, 5381965, 19280357, 18322054, 8985092, 18134014, 20811020, 1648892, 7250121, 14323990, 3504882, 24155964, 1480971, 1187315, 22481249, 9770597, 9299466, 16282605, 2213541, 22517571, 19621782, 3144791, 17932786, 18730198, 14038299, 7337410, 1453546, 4345390, 22580540, 1067467, 8330286, 3268514, 16770178, 24731657, 9483019, 6022172, 24288046, 9371024, 19311999, 11557760, 18380356, 15216501, 16192831, 20220916, 6567347, 6901106, 25019789, 9227533, 23550063, 16474307, 22188893, 14042840, 15076378, 14436788, 5297650, 22687225, 5752780, 18486536, 11725195, 22741249, 23554402, 1243504, 21712860, 22646853, 10039500, 25028094, 21834101, 23669127, 19769585, 15977195, 4741809, 7485432, 20757613, 23975610, 24143822, 6681519, 15100738, 6629490, 9139585, 21568452, 23868828, 2690291, 10849531, 23923442, 13565845, 912865, 14640246, 21199562, 13081409, 24504346, 18612613, 25115695, 11018476, 2977422, 12665071, 22356465, 21367851, 21555285, 6880757, 1994195, 10419069, 4999515, 9500184, 18180133, 6706408, 17091809, 17926344, 14814033, 2235763, 3024695, 24469720, 7725098, 1756618, 9807221, 7936281, 11903328, 6582394, 6705760, 14140711, 16516736, 11296457, 6670579, 7042077, 2783879, 18502067, 13132872, 3820040, 6198161, 9299973, 23268559, 4494351, 5440243, 23252427, 20826807, 13750547, 18995762, 13663103, 8482901, 24538789, 8720417, 10764990, 5848389, 20270525, 5216380, 6021747, 23584815, 21115449, 23475380, 22302988, 24584427, 24942897, 3855541, 10086895, 22186223, 3593198, 10590132, 1770543, 4279995, 4478442, 16794689, 4131566, 3779825, 15846634, 13483828, 12956648, 15145091, 1592510, 6447423, 10648250, 1806727, 15476535, 6814481, 14245600, 4667895, 13923567, 6735836, 20628439, 9663444, 19847057, 1985046, 5193044, 13760545, 21035637, 14905994, 10796855, 5483218, 11720519, 12724673, 20309271, 23057898, 14126967, 12225296, 1198315, 8839934, 10499431, 7792082, 21838274, 11463329, 21244073, 18392908, 9758517, 9351851};

extern void ntt_asm_const(int32_t p[SABER_N], const uint32_t _twiddles[SABER_N]);
extern void intt_asm_const(int32_t p[SABER_N], const uint32_t _twiddles_inv[SABER_N]);

extern void pointwise_mul_asm_const(int32_t des[SABER_N], const int32_t src1[SABER_N], const int32_t src2[SABER_N]);
extern void pointwise_mul_asm_const_acc(int32_t des[SABER_N], const int32_t src1[SABER_N], const int32_t src2[SABER_N]);

// // twiddle factors are required to be in a different order for the layer merge
static const uint32_t twiddles_reord[] = {15819606, 10456819, 6778549, 3927384, 13708128, 16331523, 23973142, 3333183, 12946161, 11044490, 17379375, 2113559, 4862186, 14672026, 12446784, 13450938, 19688239, 23364730, 14523207, 14374602, 18724034, 23578947, 10265463, 10026366, 12214809, 4135820, 11687629, 9324823, 11410912, 21391632, 21039891, 19978413, 8376768, 20693015, 23186411, 20891462, 23400914, 5324400, 14581325, 21578259, 15508013, 2985234, 15084562, 4543018, 21315916, 228560, 18435621, 587030, 2868469, 11247890, 1696077, 4056008, 20503562, 1586642, 19149710, 10925857, 19955077, 4900932, 18356976, 19323068, 14406467, 9694922, 16451040, 632668, 16688556, 1195847, 4413844, 11508354, 17686025, 20429648, 6175695, 9194262, 5401872, 11420910, 1502330, 3337356, 4344650, 143363, 15131957, 1919030, 2524604, 3458597, 19731214, 23927953, 1617055, 20677106, 2430208, 13446262, 1902898, 6684921, 19418677, 15871484, 2484232, 19873807, 18973296, 10734669, 10095079, 21351417, 11128617, 2982564, 12038585, 8697150, 1621394, 6669390, 15943924, 151668, 22387578, 18270351, 18604110, 18129380, 4950541, 8978626, 18500878, 9954956, 6791101, 13875000, 13613697, 5859458, 8654721, 15800433, 883411, 11030746, 19149285, 15688438, 18465697, 439800, 8401279, 18589063, 21902943, 16841171, 13268129, 24103990, 2590917, 17235176, 20826067, 23717911, 15364236, 17834047, 11133158, 23414839, 6441259, 7238671, 17446359, 22026666, 5549675, 701737, 2653886, 22957916, 22146762, 8888852, 15871991, 22935694, 15400860, 2690208, 10357424, 23984142, 23690486, 7245113, 1015493, 21666575, 8079648, 10847467, 17921336, 18465049, 23522565, 4360437, 6991324, 7037443, 16186365, 15671273, 6849403, 5891100, 20171942, 19789492, 20619013, 14752388, 20725428, 15318469, 23177262, 11058871, 17873869, 18290700, 3053282, 1397416, 3616172, 17844256, 8385038, 3803606, 2142558, 12744765, 2814992, 9981572, 24472442, 12506386, 23983096, 16456862, 22194035, 15864935, 22353801, 14152981, 3686319, 6075986, 55762, 17369762, 22215596, 6558844, 11015242, 12390938, 667111, 11259461, 6668584, 12090048, 8704176, 7134333, 3971895, 8373409, 13009476, 10531211, 2731815, 15709060, 24258592, 13564032, 15330445, 11605612, 6385828, 2920732, 1248015, 2528064, 18289886, 14321926, 13487669, 22002422, 22481166, 11771991, 14220771, 1302629, 15395272, 12464090, 3603005, 15521617, 20748932, 16031872, 7140031, 22951637, 18541967, 20990206, 12583083, 10070719, 14768256, 11209398, 18489938, 17378310, 10579778, 1027635, 24063766, 3810156};
extern void ntt_asm_leak(int32_t p[SABER_N], const uint32_t twiddles_reord[SABER_N]);

extern void __asm_16_to_32(int32_t out[SABER_N], uint16_t in[SABER_N]);
extern void __asm_32_to_16(uint16_t out[SABER_N], int32_t in[SABER_N]);


#define NTT_forward(out, in) { \
        __asm_16_to_32(out, in); \
        ntt_asm_const(out, twiddles); \
    }

#define NTT_forward_leak(out, in) { \
        __asm_16_to_32(out, in); \
        ntt_asm_leak(out, twiddles_reord); \
    }

#define NTT_mul(out, in1, in2) pointwise_mul_asm_const(out, in1, in2)
#define NTT_mul_acc(out, in1, in2) pointwise_mul_asm_const_acc(out, in1, in2)

#define NTT_inv(out, in) { \
        intt_asm_const(in, twiddles_inv_RinvN); \
        __asm_32_to_16(out, in); \
    }



#endif
